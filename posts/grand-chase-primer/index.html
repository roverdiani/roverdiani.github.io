<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Grand Chase Primer - Roverdi's Website</title><meta name=Description content="Diving inside the core of an old online game."><meta property="og:url" content="https://roverdiani.github.io/posts/grand-chase-primer/">
<meta property="og:site_name" content="Roverdi's Website"><meta property="og:title" content="Grand Chase Primer"><meta property="og:description" content="Diving inside the core of an old online game."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-06-22T13:00:00-03:00"><meta property="article:modified_time" content="2025-06-27T18:56:00-03:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Grand Chase Primer"><meta name=twitter:description content="Diving inside the core of an old online game."><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=referrer content="no-referrer"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://roverdiani.github.io/posts/grand-chase-primer/><link rel=prev href=https://roverdiani.github.io/posts/frontend-dev-first-impressions/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Grand Chase Primer","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/roverdiani.github.io\/posts\/grand-chase-primer\/"},"genre":"posts","wordcount":1126,"url":"https:\/\/roverdiani.github.io\/posts\/grand-chase-primer\/","datePublished":"2025-06-22T13:00:00-03:00","dateModified":"2025-06-27T18:56:00-03:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Roverdi"},"description":"Diving inside the core of an old online game."}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Roverdi's Website">Roverdi's Website</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/>HOME </a><a class=menu-item href=/about>ABOUT </a><a class=menu-item href=/contact>CONTACT </a><a class=menu-item href=/posts/index.xml>RSS </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Roverdi's Website">Roverdi's Website</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/ title>HOME</a><a class=menu-item href=/about title>ABOUT</a><a class=menu-item href=/contact title>CONTACT</a><a class=menu-item href=/posts/index.xml title>RSS</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Grand Chase Primer</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Roverdi</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=22/06/2025>22/06/2025</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;1126 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;6 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#networking>Networking</a><ul><li><a href=#packet-size>Packet Size</a></li><li><a href=#security-layer>Security Layer</a><ul><li><a href=#security-association>Security Association</a></li><li><a href=#security-parameters-index-spi>Security Parameters Index (SPI)</a></li><li><a href=#sequence-number>Sequence Number</a></li><li><a href=#initialization-vector-iv>Initialization Vector (IV)</a></li><li><a href=#integrity-check-value-icv>Integrity Check Value (ICV)</a></li></ul></li><li><a href=#payload-layer>Payload Layer</a></li></ul></li></ul></nav></div></div><div class=content id=content><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fas fa-exclamation-triangle fa-fw" aria-hidden=true></i>WIP!<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>This article is still a work in progress - stay tuned for more updates.</div></div></div><h1 id=introduction>Introduction</h1><p>Grand Chase is a 2D side-scrolling online game developed by the South Korean studio KOG. It was launched in Brazil in 2005 by Level Up! Games, the same publisher that also distributed Gravity&rsquo;s Ragnarok Online (another time sink of mine), as well as GunZ: The Duel (around 2006) and Perfect World (late 2000s).</p><p>All of these games were hugely popular in Brazil during my early teens, and I probably spent more time than I should&rsquo;ve playing them instead of doing homework or other boring stuff.</p><p>Grand Chase, however, holds a special place in my heart. I have fond memories of the time I spent playing it with friends, and I&rsquo;ve also always had a soft spot for side-scrolling games.</p><figure><img src=/img/gc/gc.png><figcaption><h4>Grande Chase's first mission</h4></figcaption></figure><p>That being said, another hobby of mine was trying to hack the game whenever I could - oops. But that is a story for another time.</p><p>Games in general, and specially online ones, have always captivated me and made me curious about how they work. I&rsquo;ve put a lot of time and effort into trying to understand their inner workings (I even ran a World of Warcraft private server at one point), and with Grand Chase, it wasn&rsquo;t any different.</p><p>So, on this page, I&rsquo;ll be writing about the things I&rsquo;ve learned by digging into the available material on the game. Hope you find it interesting!</p><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw" aria-hidden=true></i>Tip<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>Although this article focuses mainly on the Season 1 version (my favorite one!), most of this content can be applied to the other seasons. The core of the game, especially the network stuff, is pretty much the same.</div></div></div><hr><h2 id=networking>Networking</h2><p>In this section, we&rsquo;ll talk about how the game&rsquo;s networking works - the packet structure, security protocols, compression, and so on.</p><p>Below, you can see the overall structure of the game&rsquo;s packets:</p><div class=mermaid id=id-1></div><p>To help us understand how everything works together, we&rsquo;ll separate this structure into three parts: the packet size, the security layer, and the payload layer.</p><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>Note<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>Aside from the decrypted payload data&rsquo;s content, all the fields here are <a href=https://en.wikipedia.org/wiki/Endianness target=_blank rel="noopener noreffer">little-endian</a>.</div></div></div><h3 id=packet-size>Packet Size</h3><p>As the name implies, this field tells us the total size (in bytes) of the received packet, including the size of this field - simple as that. Here&rsquo;s an example:</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-hex"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><pre tabindex=0><code class=language-hex data-lang=hex>4A 00</code></pre></div><p>That value means that we have exactly <strong>74 bytes</strong> in our packet.</p><h3 id=security-layer>Security Layer</h3><p>This layer is built upon a variation of the security protocol called <a href=https://en.wikipedia.org/wiki/IPsec#Encapsulating_Security_Payload target=_blank rel="noopener noreffer">Encapsulating Security Payload</a> (<a href=/files/rfc2406.pdf rel>RFC2406</a>), from the <a href=https://en.wikipedia.org/wiki/IPsec target=_blank rel="noopener noreffer">IPsec</a> suite (<a href=/files/rfc2401.pdf rel>RFC2401</a>), and consists of the Security Parameters Index, Sequence Number, Initialization Vector, and Integrity Check Value fields.</p><p>This protocol provides authentication, data integrity, and confidentiality to the data being transmitted, in addition to protection against <a href=https://en.wikipedia.org/wiki/Replay_attack target=_blank rel="noopener noreffer">replay attacks</a> (more on that later).</p><h4 id=security-association>Security Association</h4><p>A <a href=https://en.wikipedia.org/wiki/Security_association target=_blank rel="noopener noreffer">Security Association</a> (SA) defines a one-way secure connection between two parties (e.g., a game client and server), specifying how they encrypt and authenticate traffic. Each SA includes parameters like encryption algorithms, keys and a Securiry Parameter Index (SPI) to identify it. Those parameters are described individually below.</p><p>Because SAs are one-directional, two are needed for full communication: one for outgoing traffic and another for incoming. The server tracks SAs per client, using the client&rsquo;s IP address and SPI to select the right one.</p><h4 id=security-parameters-index-spi>Security Parameters Index (SPI)</h4><p>These two bytes represent an arbitrary value used (together with the destination IP address) to identify the security association that should be used by the packet receiver (client or server).</p><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>Note<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>Both the client and the server use different security associations, so an SPI is defined for each of them. Because of this, the packets sent by either party will contain different SPIs in their security layers.</div></div></div><p>For a new connection, this value will always refer to the default security association, since no key exchange has taken place yet. Examples:</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Hex"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><pre tabindex=0><code class=language-Hex data-lang=Hex>// Default SPI
00 00

// Arbitrary value
13 4F

// Maximum value
FF FF</code></pre></div><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw" aria-hidden=true></i>Trivia<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>In the original server code, there was a bug where, if there were no more slots available for a new SPI, the code would hang in an infinite loop. However, this was an edge case - you&rsquo;d need 65,534 players connected to fill up all the slots, which would probably never happen in the practice.</div></div></div><h4 id=sequence-number>Sequence Number</h4><p>This is a counter that increments by 1 for every packet sent and is used to protect against replay attacks. Each security association should have its own separate counter.</p><p>Used together with a <a href=https://en.wikipedia.org/wiki/Mask_%28computing%29 target=_blank rel="noopener noreffer">mask</a>, an algorithm performs a check to see wether the packet has already been received or not.</p><p>The sequence number cannot be zero, as it would be considered invalid and would cause the communication to be closed. Example:</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-hex"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><pre tabindex=0><code class=language-hex data-lang=hex>// Valid sequence number
03 00 00 00</code></pre></div><h4 id=initialization-vector-iv>Initialization Vector (IV)</h4><p>An <a href=https://en.wikipedia.org/wiki/Initialization_vector target=_blank rel="noopener noreffer">Initialization Vector</a> is a crucial component in encryption that introduces randomness to secure data. During encryption, the IV scrambles the input, ensuring that identical data produces unique <a href=https://en.wikipedia.org/wiki/Ciphertext target=_blank rel="noopener noreffer">ciphertext</a> every time - even when encrypted with the same key. This encrypted output, along with the IV itself, is then transmitted to enable proper decryption by the server.</p><p>In Grand Chase, the IV follows a fixed 8-byte length (as dictated by the cryptographic algorithm, which we&rsquo;ll detail later). However, the implementation shows an unusual pattern where all bytes share the same value:</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-hex"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><pre tabindex=0><code class=language-hex data-lang=hex>// Example of Initialization Vector
23 23 23 23 23 23 23 23</code></pre></div><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw" aria-hidden=true></i>Trivia<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>While IVs should ideally be unique and random to prevent vulnerabilities, the original server code used the same value for all the bytes each time a vector is generated, and it doesn&rsquo;t guarantee that it will never be repeated. This approach can lead to security vulnerabilities.</div></div></div><h4 id=integrity-check-value-icv>Integrity Check Value (ICV)</h4><p>The Integrity Check Value (ICV) acts as a checksum to verify that packet hasn&rsquo;t been tampered with. In Grand Chase, it consists of the last 10 bytes of the packet and is calculated using <a href=https://en.wikipedia.org/wiki/MD5 target=_blank rel="noopener noreffer">MD5</a>-<a href=https://en.wikipedia.org/wiki/HMAC target=_blank rel="noopener noreffer">HMAC</a> (Hash-based Message Authentication Code).</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-hex"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><pre tabindex=0><code class=language-hex data-lang=hex>// Example of Integrity Check Value
0C A6 9E B2 34 FD D3 1A C3 C7</code></pre></div><p>The ICV is calculated using the packet bytes from the first byte after the size field to the last byte of the payload data, along with an 8-byte authentication key defined at the start of the communication (this exchange will be described later).</p><div class="details admonition example open"><div class="details-summary admonition-title"><i class="icon fas fa-list-ol fa-fw" aria-hidden=true></i>Authentication Key<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>The key used for ICV calculation is:</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-hex"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><pre tabindex=0><code class=language-hex data-lang=hex>C0 D3 BD C3 B7 CE B8 B8</code></pre></div></div></div></div><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw" aria-hidden=true></i>Trivia<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>While an MD5-HMAC normally produces a 16-byte output, Grand Chase truncates it to 10 bytes.</div></div></div><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw" aria-hidden=true></i>Trivia<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>In the original code, the Authentication Key was initialized with the string &ldquo;<strong>임시로만드는키</strong>&rdquo; (which, when truncated to 8 bytes, produces the byte array shown above). According to ChatGPT, this roughly translates to &ldquo;<em>A temporary key</em>&rdquo; &#x1f601;</div></div></div><h3 id=payload-layer>Payload Layer</h3><p>TODO</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 27/06/2025</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/frontend-dev-first-impressions/ class=prev rel=prev title="First Impressions as a Frontend Developer"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>First Impressions as a Frontend Developer</a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i></a></div><div id=fixed-buttons-hidden><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.2/sharer.min.js></script><script>window.config={comment:{}}</script><script src=/js/theme.min.js></script></body></html>